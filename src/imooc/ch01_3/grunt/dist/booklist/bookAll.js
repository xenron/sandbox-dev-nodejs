/*! TestGrunt 2014-06-16 */
$(function(){function renderBooks(a,b){if(a&&a.length){var c=Handlebars.compile($("#book-item-tpl").html()),d=c({items:a});1===b.currentPage?$("#bookContainer").html(d):$("#bookContainer").append(d)}}function renderCategoryMenus(param){$.ajax({url:"getCategoryByPid.action",data:{pId:"7"}}).done(function(serverData,textStatus,jqXHR){var data=eval("("+jqXHR.responseText+")");if(data&&data.length){var categoryMenus=Handlebars.compile($("#category-menu-item-tpl").html()),categoryMenusHtml=categoryMenus({items:data});$("#book-category-menu .dropdown-menu").append(categoryMenusHtml),$("#book-category-menu .dropdown-menu a").click(function(){param.termPath=$(this).attr("term_path"),$("#book-category-btn").html($(this).text()),$("#loadMoreBtn").autoLoader("setParam",param),$("#loadMoreBtn").autoLoader("reset")})}}).fail(function(){})}function registerSortBtn(a){var b=function(){var b=$(this),c=b.attr("sort_key"),d=b.find(".glyphicon-arrow-down"),e=b.find(".glyphicon-arrow-up");"1"===a[c]?(a[c]="0",e.show(),d.hide()):(a[c]="1",d.show(),e.hide()),$("#loadMoreBtn").autoLoader("setParam",a),$("#loadMoreBtn").autoLoader("reset")};$("#book-sort-btn-group button").click(b)}function renderNewBookIntro(){$.ajax({url:"getBookAndAuthorByStatus.action",data:{status:"9",bookMaterial:"1",start:"0",limit:"15"}}).done(function(serverData,textStatus,jqXHR){var data=eval("("+jqXHR.responseText+")");if(data&&data.length){var newBookIntroBarHtml=commonPanelTpl({id:"newBookIntroContainer",title:"新书预告"});$("#bookSiderBar").append(newBookIntroBarHtml);var header=data.splice(0,1)[0],bookIntroBar=Handlebars.compile($("#new-book-intro").html()),bookIntroHtml=bookIntroBar({header:header,items:data});$("#newBookIntroContainer .data-panel-content").append(bookIntroHtml)}}).fail(function(){})}renderNewBookIntro();var param={length:"300",termPath:"/1/7",pubTime:"1",origPrice:"1",collectTime:"1"};renderCategoryMenus(param),registerSortBtn(param),$("#loadMoreBtn").autoLoader("init",{url:"getBookByCategoryOnOrder.action",param:param,resetHandler:function(){$("#bookContainer").html("")},successHandler:function(a,b){renderBooks(a,b)}})});