A Grunt build system. 

To install:

	$ npm install
	
To build:

	$ grunt
or:
	$ npm test

Creates

	/build
		/stage
		/deploy

Directories out of a

	/source

directory.

Will read any .html files in `/source` for build directives:

    <title><%= title %></title>

	<!-- build:[href] img/ -->
	<link rel="apple-touch-icon-precomposed" href="path/to/apple-touch-icon-precomposed.png">
	<link rel="apple-touch-icon-precomposed" href="path/to/apple-touch-icon-72x72-precomposed.png" sizes="72x72">
	<link rel="apple-touch-icon-precomposed" href="path/to/apple-touch-icon-114x114-precomposed.png" sizes="114x114">
	<link rel="apple-touch-icon-precomposed" href="path/to/apple-touch-icon-144x144-precomposed.png" sizes="144x144">
	<!-- /build -->
	
	<!-- build:css:deploy css/style.min.css -->
		<link rel="stylesheet" href="css/normalize.css">
		<link rel="stylesheet" href="css/main.css">
	<!-- /build -->
	
	</head>
	<body>
	
	<!-- build:remove -->
	<p>This should be removed after build</p>
	<!-- /build -->
	
	<!-- build:template
	<p><%= message %></p>
	/build -->
	
	<!-- build:js:deploy js/app.min.js -->
	<script src="js/file1.js"></script>
	<script src="js/file2.js"></script>
	<script src="js/file3.js"></script>
	<!-- /build -->
	
	</body>

and transform this source file into this for `/stage`:

	<title><%= title %></title>
	
	<link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-precomposed.png">
	<link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-72x72-precomposed.png" sizes="72x72">
	<link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-114x114-precomposed.png" sizes="114x114">
	<link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-144x144-precomposed.png" sizes="144x144">
	
	<!-- build:css:deploy css/style.min.css -->
		<link rel="stylesheet" href="css/normalize.css">
		<link rel="stylesheet" href="css/main.css">
	<!-- /build -->
	
	</head>
	<body>
	
	<p>STAGE target</p>
	
	<!-- build:js:deploy js/app.min.js -->
	<script src="js/file1.js"></script>
	<script src="js/file2.js"></script>
	<script src="js/file3.js"></script>
	<!-- /build -->
	
	</body>
  
and this for `/deploy`

	<title>My app</title>
	
	<link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-precomposed.png">
	<link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-72x72-precomposed.png" sizes="72x72">
	<link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-114x114-precomposed.png" sizes="114x114">
	<link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-144x144-precomposed.png" sizes="144x144">
	
	<link rel="stylesheet" href="css/style.min.css">
	
	</head>
	<body>
	
	<p>DEPLOY target</p>
	
	<script src="js/app.min.js"></script>
	
	</body>

Build Directives
----------------

The `css/style.min.css` and `js/app.min.js` files you see above are autogenerated concatenations and minifications of the css and js files found in each block controlled by directives. 

This in /source:

	<!-- build:js:deploy js/app.min.js -->
	<script src="js/file1.js"></script>
	<script src="js/file2.js"></script>
	<script src="js/file3.js"></script>
	<!-- /build -->
	
Becomes this in `/deploy`:

	<script src="js/app.min.js"></script>
 
And contains:

	function a(){}function b(){}function c(){}

Because of the directive:

	<!-- build:js:deploy js/app.min.js -->
	
In your Gruntfile you will set any template variables for both the `stage/` and `deploy/` collections. This is for `/deploy`:

	deploy: {
		options: {
			data: {
				title: "Striving",
				message: "DEPLOY target"
			}
		}
	}

The properties of `data` will be interpolated, such as when this exists within an `html` file in `source`:

    <title><%= title %></title> <-- Will become <title>Striving</title> 
	
If you don't like `build` as a directory name change it to some other folder in the `config` block and your build will move there:

	var config = {
			
		...
		
		//	The folder into which built /stage and /deploy are placed.
		//	If you change this, update the .gitignore file (it should be ignored).
		//
		buildDir	: "myBuildDir"

Same with the `source` folder:

	var config = {
			
		...
		
		//	Set to whichever folder your source files exist in.
		//
		sourceDir	: "source"

Testing
-------

Testing is automatic and headless and done with `Mocha` and `PhantomJS`.

Create `/test/spec` files for testing:

	describe('tester', function() {
		beforeEach(function() {
			this.tester = tester;
		});
	
		afterEach(function() {
			delete this.tester;
		});
		
		describe("#testing", function() {
		
			it("should add 2 + 2 = 4", function() {
				expect(this.tester.add(2,2)).to.eql(4);
			});
		});
	});

Which might be testing this file existing anywhere in your application:

	var tester = {
		add : function(a, b) {
			return a + b;
		}
	};
	
Tests are run headlessly by `PhantomJS` against HTML files that might look like this:

    <!-- build:js:deploy js/app.min.js -->
    <script src="js/file1.js"></script>
    <!-- /build -->
    
    <!-- build:remove:deploy -->
    <script src="../../test/framework.js"></script>
    <script src="../../test/spec/file1.js"></script>   
    <!-- /build -->

Where we have our normal application page loading `file1.js` and the testing spec runner for that file following.  You may have any number of `/spec` files listed.

Note that the testing harness is removed from `/deploy`, as it should.

After `$ grunt` your application is deployed as described supra, and tests are run:

	Running "processhtml:stage" (processhtml) task
	...
	build/stage/js/file1.js" created.
	...
	
	Running "jshint:files" (jshint) task
	>> 6 files lint free.
	
	Running "connect:server" (connect) task
	Starting connect web server on localhost:8981.
	
	Running "mocha:runner" (mocha) task
	Testing: build/stage/index.html

	tester
		#testing
			✓ should add 2 + 2 = 4 
	
	  1 test complete (2 ms)
	
	>> 1 passed! (0.00s)
	
	Done, without errors.
	
The same code can be modified slightly to allow `Mocha` tests to be run in the browser:

    <!-- build:remove:deploy -->
    <script src="../../test/framework.js"></script>
    <script src="../../test/spec/file1.js"></script>   
    <script>
    	mocha.run(); // Run in browser
    </script>
    <!-- /build -->

Where this will be displayed in the DOM:

	tester
		#testing
			✓ should add 2 + 2 = 4 

